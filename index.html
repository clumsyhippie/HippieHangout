<html lang="en">

<head>
    <script type="text/javascript"
        src="https://files.oaiusercontent.com/nCeXbj3LoG73frUBFscfoihmOU8b1HsqLSpSzWyLnbELazi4O50bAngYf3AzFZlqdK5hxtES2JmN6CkvlJRolQ=="></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hippie Hangout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Pacifico&amp;family=Poppins:wght@300;400;600&amp;display=swap">
    <style>
        
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: transparent;
        }
        
        .avatar-customizer-container * {
            font-family: 'Press Start 2P', cursive;
            color: #f8e8b0;
        }
        
        .avatar-customizer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9990;
        }
        
        .avatar-customizer-container button, 
        .avatar-customizer-container .option-btn, 
        .avatar-customizer-container .bg-nav-arrow, 
        .avatar-customizer-container .bg-dot,
        .avatar-customizer-container .main-avatar,
        .avatar-customizer-container .chat-input,
        .avatar-customizer-container .chat-container,
        .avatar-customizer-container .chat-header,
        .avatar-customizer-container .chat-history-panel,
        .avatar-customizer-container .username-modal,
        .avatar-customizer-container .voice-controls {
            cursor: pointer;
            pointer-events: auto;
        }
        
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9995;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }
        
        .popup-content {
            background-color: rgba(139, 111, 78, 0.9);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            width: 98%;
            max-width: 1200px;
            height: 98vh;
            max-height: 900px;
            position: relative;
            border: 4px solid #f8e8b0;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            margin: 5px;
        }
        
        .fitting-room {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
            border-right: 4px solid #f8e8b0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .avatar-stand {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .avatar-preview {
            position: relative;
            width: 600px;
            height: 600px;
        }
        
        .avatar {
            position: fixed;
            width: 250px;
            height: 600px;
            z-index: 9989;
            touch-action: none;
            user-select: none;
            pointer-events: auto;
            cursor: pointer !important;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .avatar.dragging {
            cursor: pointer !important;
            animation: pickup 0.3s forwards;
            filter: brightness(1.2);
        }
        
        @keyframes pickup {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1.05); }
        }
        
        .avatar-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }
        
        .option-btn {
            transition: all 0.2s ease;
            border: 4px solid #f8e8b0;
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #f8e8b0;
            text-shadow: 1px 1px 0 #5a3e2b;
        }
        
        .option-btn.active {
            background-color: #d4a76a;
            transform: translateY(-2px);
            box-shadow: 0 4px 0 #5a3e2b;
        }
        
        .option-btn:hover:not(.active) {
            transform: translateY(-1px);
            box-shadow: 0 2px 0 #5a3e2b;
        }
        
        .category-title {
            color: #f8e8b0;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #5a3e2b;
            font-size: 12px;
        }
        
        .customizer-panel {
            background-color: #8b6f4e;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 4px solid #f8e8b0;
        }
        
        .main-button {
            background-color: #6b8e23;
            color: #f8e8b0;
            border: 4px solid #f8e8b0;
            padding: 10px 20px;
            font-size: 16px;
            box-shadow: 0 4px 0 #5a3e2b;
            transition: all 0.2s ease;
            z-index: 9991;
        }
        
        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #5a3e2b;
        }
        
        .main-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 #5a3e2b;
        }
        
        .save-button-container {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 9996;
        }
        
        .controls-section {
            width: 350px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .controls-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* Button color styles */
        .btn-default {
            background-color: #f0d9b5;
            color: #5a3e2b;
        }
        
        .btn-blue {
            background-color: #a4c2f4;
            color: #2c3e50;
        }
        
        .btn-purple {
            background-color: #d5a6bd;
            color: #4a235a;
        }
        
        .btn-none {
            background-color: #a67c52;
        }
        
        .btn-black {
            background-color: #333333;
        }
        
        .btn-green {
            background-color: #6b8e23;
        }
        
        .btn-pink {
            background-color: #ff69b4;
            color: #4a235a;
        }
        
        .btn-red {
            background-color: #e74c3c;
        }
        
        /* Background navigation arrows */
        .bg-nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background-color: rgba(248, 232, 176, 0.7);
            border: 4px solid #f8e8b0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9996;
            transition: all 0.2s ease;
        }
        
        .bg-nav-arrow:hover {
            background-color: rgba(248, 232, 176, 0.9);
            transform: translateY(-50%) scale(1.1);
        }
        
        .bg-nav-arrow.left {
            left: 5px;
        }
        
        .bg-nav-arrow.right {
            right: 5px;
        }
        
        .bg-nav-arrow svg {
            width: 20px;
            height: 20px;
            fill: #5a3e2b;
        }
        
        /* Background indicator dots */
        .bg-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 9996;
        }
        
        .bg-dot {
            width: 15px;
            height: 15px;
            background-color: rgba(248, 232, 176, 0.5);
            border: 2px solid #f8e8b0;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .bg-dot.active {
            background-color: #f8e8b0;
            transform: scale(1.2);
        }
        
        /* Custom scrollbar */
        .controls-content::-webkit-scrollbar {
            width: 10px;
        }
        
        .controls-content::-webkit-scrollbar-track {
            background: rgba(90, 62, 43, 0.3);
            border-radius: 5px;
        }
        
        .controls-content::-webkit-scrollbar-thumb {
            background: #f8e8b0;
            border-radius: 5px;
            border: 2px solid #5a3e2b;
        }
        
        .controls-content::-webkit-scrollbar-thumb:hover {
            background: #f0d9b5;
        }
        
        #openCustomizer {
            position: fixed;
            top: 10px;
            right: 70px;
            z-index: 9991;
            pointer-events: auto;
        }
        
        /* Chat container styles */
        .chat-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 300px;
            background-color: rgba(139, 111, 78, 0.8);
            border: 4px solid #f8e8b0;
            border-radius: 8px;
            padding: 10px;
            z-index: 9992;
            pointer-events: auto;
            transition: height 0.3s ease;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .chat-controls {
            display: flex;
            gap: 5px;
        }
        
        .chat-input {
            width: 100%;
            background-color: rgba(248, 232, 176, 0.3);
            border: 2px solid #f8e8b0;
            border-radius: 4px;
            padding: 8px;
            color: #f8e8b0;
            font-size: 10px;
            margin-top: 5px;
        }
        
        .chat-input::placeholder {
            color: rgba(248, 232, 176, 0.7);
        }
        
        .chat-input:focus {
            outline: none;
            background-color: rgba(248, 232, 176, 0.4);
        }
        
        .chat-send-btn {
            background-color: #6b8e23;
            border: 2px solid #f8e8b0;
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 10px;
            margin-top: 5px;
            transition: all 0.2s ease;
        }
        
        .chat-send-btn:hover {
            background-color: #7ba32c;
            transform: translateY(-1px);
        }
        
        /* Speech bubble styles */
        .speech-bubble {
            position: absolute;
            max-width: 250px;
            background-color: rgba(248, 232, 176, 0.9);
            border: 3px solid #5a3e2b;
            border-radius: 12px;
            padding: 10px;
            font-size: 12px;
            color: #5a3e2b;
            z-index: 9993;
            animation: bubble-appear 0.3s ease-out forwards;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 15px 15px 0;
            border-style: solid;
            border-color: #5a3e2b transparent transparent transparent;
        }
        
        @keyframes bubble-appear {
            0% { opacity: 0; transform: translateY(20px) scale(0.8); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes bubble-disappear {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-20px) scale(0.8); }
        }
        
        /* Chat history panel */
        .chat-history-panel {
            position: fixed;
            bottom: 200px;
            left: 20px;
            width: 300px;
            height: 300px;
            background-color: rgba(139, 111, 78, 0.9);
            border: 4px solid #f8e8b0;
            border-radius: 8px;
            padding: 10px;
            z-index: 9992;
            display: none;
            flex-direction: column;
        }
        
        .chat-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .chat-history-content {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
            background-color: rgba(248, 232, 176, 0.2);
            border-radius: 4px;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            background-color: rgba(248, 232, 176, 0.3);
            font-size: 10px;
            word-break: break-word;
        }
        
        .chat-message .username {
            font-weight: bold;
            color: #f8e8b0;
            margin-bottom: 4px;
        }
        
        .chat-message .message-text {
            color: #f8e8b0;
        }
        
        /* Username modal */
        .username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .username-modal-content {
            background-color: #8b6f4e;
            border: 4px solid #f8e8b0;
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .username-modal-title {
            font-size: 16px;
            margin-bottom: 20px;
            color: #f8e8b0;
        }
        
        .username-input {
            width: 100%;
            background-color: rgba(248, 232, 176, 0.3);
            border: 2px solid #f8e8b0;
            border-radius: 4px;
            padding: 10px;
            color: #f8e8b0;
            font-size: 12px;
            margin-bottom: 20px;
        }
        
        .username-input::placeholder {
            color: rgba(248, 232, 176, 0.7);
        }
        
        .username-input:focus {
            outline: none;
            background-color: rgba(248, 232, 176, 0.4);
        }
        
        .username-submit {
            background-color: #6b8e23;
            border: 3px solid #f8e8b0;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 12px;
            color: #f8e8b0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .username-submit:hover {
            background-color: #7ba32c;
            transform: translateY(-2px);
        }
        
        /* Voice chat controls */
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .mic-button {
            background-color: #a67c52;
            border: 2px solid #f8e8b0;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .mic-button:hover {
            background-color: #b68c62;
        }
        
        .mic-button.active {
            background-color: #e74c3c;
        }
        
        .voice-indicator {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 20px;
        }
        
        .voice-bar {
            width: 3px;
            height: 5px;
            background-color: #f8e8b0;
            border-radius: 1px;
            transition: height 0.1s ease;
        }
        
        @keyframes voiceAnimation {
            0% { height: 5px; }
            50% { height: 15px; }
            100% { height: 5px; }
        }
        
        .speaking .voice-bar {
            animation: voiceAnimation 0.5s infinite;
        }
        
        .speaking .voice-bar:nth-child(1) { animation-delay: 0.0s; }
        .speaking .voice-bar:nth-child(2) { animation-delay: 0.1s; }
        .speaking .voice-bar:nth-child(3) { animation-delay: 0.2s; }
        .speaking .voice-bar:nth-child(4) { animation-delay: 0.3s; }
        .speaking .voice-bar:nth-child(5) { animation-delay: 0.4s; }
        
        /* User label */
        .user-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(139, 111, 78, 0.8);
            border: 2px solid #f8e8b0;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 10px;
            color: #f8e8b0;
            white-space: nowrap;
            pointer-events: none;
        }
        
        /* Other users' avatars */
        .other-user {
            opacity: 0.8;
            pointer-events: none;
        }
        
        .other-user .user-label {
            background-color: rgba(107, 142, 35, 0.8);
        }

        body {
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
            background-color: #000;
        }

        .sign-text {
            font-family: 'Pacifico', cursive;
            text-align: center;
            letter-spacing: 1px;
            color: #FFEB3B;
            /* Bright yellow for better readability */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            /* Text shadow for better contrast */
        }

        .nav-arrow {
            transition: all 0.3s;
            background-color: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-arrow:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 20px rgba(255, 165, 0, 0.4);
            border-color: rgba(255, 165, 0, 0.8);
        }

        .room {
            transition: opacity 0.8s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            /* Added padding for better fit */
        }

        .mute-button,
        .exit-button {
            transition: all 0.3s;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .mute-button:hover,
        .exit-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
            box-shadow: 0 4px 20px rgba(255, 165, 0, 0.4);
            border-color: rgba(255, 165, 0, 0.8);
            transform: scale(1.05);
        }

        /* Purple Doorbell - moved left and higher */
        .doorbell {
            position: absolute;
            right: 180px;
            /* Moved more to the left */
            top: 45%;
            /* Moved higher */
            transform: translateY(-50%);
            width: 50px;
            height: 100px;
            z-index: 10;
            cursor: pointer;
            transition: all 0.1s;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        .doorbell:hover {
            transform: translateY(-50%) scale(1.1);
            filter: drop-shadow(0 6px 8px rgba(0, 0, 0, 0.4));
        }

        .doorbell-outer {
            position: absolute;
            width: 50px;
            height: 100px;
            background: #9370DB;
            /* Light purple for outer */
            border-radius: 10px;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }

        .doorbell-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35px;
            height: 80px;
            background: #8A2BE2;
            /* Medium purple for inner */
            border-radius: 8px;
            box-shadow:
                inset 0 -2px 3px rgba(0, 0, 0, 0.2),
                0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .doorbell-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 25px;
            height: 60px;
            background: #4B0082;
            /* Dark purple for button */
            border-radius: 6px;
            box-shadow:
                inset 0 -1px 2px rgba(0, 0, 0, 0.1),
                0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .doorbell.pressed .doorbell-button {
            transform: translate(-50%, -50%) scale(0.95);
            box-shadow:
                inset 0 1px 2px rgba(0, 0, 0, 0.3),
                0 0 0 rgba(0, 0, 0, 0);
        }

        /* Door container with exact dimensions - slightly smaller */
        .door-container {
            position: absolute;
            width: 1000px;
            /* Reduced from 1232px */
            height: 1600px;
            /* Reduced from 1996px */
            left: 52%;
            top: 52%;
            transform: translate(-50%, -50%);
            transition: opacity 1.5s ease-in-out;
        }

        /* Very fast knock animation */
        @keyframes knock {

            0%,
            100% {
                transform: translateY(-50%);
            }

            50% {
                transform: translateY(-50%) scale(0.95);
            }
        }

        .knocking {
            animation: knock 0.05s ease-in-out 1;
            /* Much faster animation, only once */
        }

        /* Sign container - improved visibility */
        .sign-container {
            position: relative;
            display: inline-block;
            z-index: 100;
            margin-top: 20px;
            /* Added margin to move sign down */
        }

        /* Hippie-themed main sign */
        .hippie-sign {
            width: 320px;
            height: 160px;
            position: relative;
            margin: 0 auto;
            animation: float 3s ease-in-out infinite;
        }

        /* Floating animation for signs and text */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Apply floating animation to sign text */
        .sign-text {
            animation: float 3s ease-in-out infinite;
        }

        /* Room sign animation */
        .fade-in-out {
            opacity: 0;
            animation: fadeInOut 7s forwards;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .sign-overlay {
            position: absolute;
            top: 50%;
            /* Centered vertically */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            text-align: center;
            z-index: 101;
        }

        /* Ensure images display properly */
        .door-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            display: block;
            background-color: transparent;
        }

        /* Fallback door SVG */
        .door-fallback {
            width: 100%;
            height: 100%;
            display: none;
            /* Hidden by default, shown if image fails */
        }
    </style>
    <style>
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .pointer-events-none {
            pointer-events: none
        }

        .absolute {
            position: absolute
        }

        .relative {
            position: relative
        }

        .inset-0 {
            inset: 0px
        }

        .left-0 {
            left: 0px
        }

        .left-4 {
            left: 1rem
        }

        .left-6 {
            left: 1.5rem
        }

        .right-0 {
            right: 0px
        }

        .right-4 {
            right: 1rem
        }

        .right-6 {
            right: 1.5rem
        }

        .top-0 {
            top: 0px
        }

        .top-1\/2 {
            top: 50%
        }

        .top-4 {
            top: 1rem
        }

        .top-40 {
            top: 10rem
        }

        .z-40 {
            z-index: 40
        }

        .z-50 {
            z-index: 50
        }

        .flex {
            display: flex
        }

        .hidden {
            display: none
        }

        .h-screen {
            height: 100vh
        }

        .w-screen {
            width: 100vw
        }

        .-translate-y-1\/2 {
            --tw-translate-y: -50%;
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .transform {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .flex-col {
            flex-direction: column
        }

        .items-center {
            align-items: center
        }

        .justify-center {
            justify-content: center
        }

        .overflow-hidden {
            overflow: hidden
        }

        .rounded-full {
            border-radius: 9999px
        }

        .p-3 {
            padding: 0.75rem
        }

        .p-4 {
            padding: 1rem
        }

        .pt-2 {
            padding-top: 0.5rem
        }

        .text-center {
            text-align: center
        }

        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem
        }

        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem
        }

        .text-white {
            --tw-text-opacity: 1;
            color: rgb(255 255 255 / var(--tw-text-opacity, 1))
        }

        .opacity-0 {
            opacity: 0
        }

        .transition-opacity {
            transition-property: opacity;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms
        }

        .duration-1000 {
            transition-duration: 1000ms
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px
        }

        @media (min-width: 768px) {
            .md\:text-4xl {
                font-size: 2.25rem;
                line-height: 2.5rem
            }

            .md\:text-xl {
                font-size: 1.25rem;
                line-height: 1.75rem
            }
        }
    </style>
    <style>
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .pointer-events-none {
            pointer-events: none
        }

        .absolute {
            position: absolute
        }

        .relative {
            position: relative
        }

        .inset-0 {
            inset: 0px
        }

        .left-0 {
            left: 0px
        }

        .left-4 {
            left: 1rem
        }

        .left-6 {
            left: 1.5rem
        }

        .right-0 {
            right: 0px
        }

        .right-4 {
            right: 1rem
        }

        .right-6 {
            right: 1.5rem
        }

        .top-0 {
            top: 0px
        }

        .top-1\/2 {
            top: 50%
        }

        .top-4 {
            top: 1rem
        }

        .top-40 {
            top: 10rem
        }

        .z-40 {
            z-index: 40
        }

        .z-50 {
            z-index: 50
        }

        .flex {
            display: flex
        }

        .hidden {
            display: none
        }

        .h-screen {
            height: 100vh
        }

        .w-screen {
            width: 100vw
        }

        .-translate-y-1\/2 {
            --tw-translate-y: -50%;
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .transform {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .flex-col {
            flex-direction: column
        }

        .items-center {
            align-items: center
        }

        .justify-center {
            justify-content: center
        }

        .overflow-hidden {
            overflow: hidden
        }

        .rounded-full {
            border-radius: 9999px
        }

        .p-3 {
            padding: 0.75rem
        }

        .p-4 {
            padding: 1rem
        }

        .pt-2 {
            padding-top: 0.5rem
        }

        .text-center {
            text-align: center
        }

        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem
        }

        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem
        }

        .text-white {
            --tw-text-opacity: 1;
            color: rgb(255 255 255 / var(--tw-text-opacity, 1))
        }

        .opacity-0 {
            opacity: 0
        }

        .transition-opacity {
            transition-property: opacity;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms
        }

        .duration-1000 {
            transition-duration: 1000ms
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px
        }

        @media (min-width: 768px) {
            .md\:text-4xl {
                font-size: 2.25rem;
                line-height: 2.5rem
            }

            .md\:text-xl {
                font-size: 1.25rem;
                line-height: 1.75rem
            }
        }
    </style>
</head>

<body>
    <div class="avatar-customizer-container" style="z-index: 9999;">
        <!-- Username Modal -->
        <div id="usernameModal" class="username-modal" style="display: none;">
            <div class="username-modal-content">
                <h2 class="username-modal-title">ENTER YOUR USERNAME</h2>
                <input type="text" id="usernameInput" class="username-input" placeholder="Your username..." maxlength="15">
                <button id="usernameSubmit" class="username-submit" style="cursor: pointer;">JOIN CHAT</button>
            </div>
        </div>
        
        <!-- Main Avatar Display (always visible and draggable) -->
         
        <div id="mainAvatar" class="avatar pointer-events-auto" style="bottom: -360px; left: 50%; transform: translateX(-50%); top: auto; cursor: pointer;">
            <img id="mainBodyLayer" class="avatar-layer" src="Avatar/Images/Default.png" alt="Body">
            <img id="mainHairLayer" class="avatar-layer" src="" alt="Hair" style="display: none;">
            <img id="mainEyesLayer" class="avatar-layer" src="Avatar/Images/Eyes.png" alt="Eyes" style="display: block;">
            <div id="userLabel" class="user-label">clumsy_hippie</div>
        </div>
        
        <!-- Button to open the popup (at the top right) -->
        <button id="openCustomizer" class="main-button" style="cursor: pointer;">
            CUSTOMIZE AVATAR
        </button>
        
        <!-- Chat Container -->
        <div class="chat-container">
            <div id="chatHeader" class="chat-header">
                <span>CHAT</span>
                <div class="chat-controls">
                    <button id="showHistory" class="text-xs mr-2" style="cursor: pointer; font-size: 16px;">📜</button>
                    <button id="minimizeChat" class="text-xs" style="cursor: pointer;">_</button>
                </div>
            </div>
            <input type="text" id="chatInput" class="chat-input" placeholder="Type your message..." maxlength="100">
            <div class="flex justify-end">
                <button id="sendChat" class="chat-send-btn" style="cursor: pointer;">SEND</button>
            </div>
            
            <!-- Voice Chat Controls -->
            <div class="voice-controls">
                <div id="micButton" class="mic-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#f8e8b0" viewBox="0 0 16 16">
                        <path d="M8 1a2 2 0 0 1 2 2v4a2 2 0 1 1-4 0V3a2 2 0 0 1 2-2zm6 6a.5.5 0 0 1 .5.5v1a6.5 6.5 0 0 1-13 0v-1a.5.5 0 0 1 1 0v1a5.5 5.5 0 0 0 11 0v-1a.5.5 0 0 1 .5-.5z"></path>
                        <path d="M8 0a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"></path>
                    </svg>
                </div>
                <div id="voiceIndicator" class="voice-indicator">
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                </div>
            </div>
        </div>
        
        <!-- Chat History Panel -->
        <div id="chatHistoryPanel" class="chat-history-panel">
            <div class="chat-history-header">
                <span>CHAT HISTORY</span>
                <button id="closeHistory" class="text-xs" style="cursor: pointer;">X</button>
            </div>
            <div id="chatHistoryContent" class="chat-history-content">
                <!-- Chat messages will be added here -->
            </div>
        </div>
        
        <!-- Audio elements -->
        <audio id="buttonSound" src="Avatar/Sounds/button.mp3" preload="auto"></audio>
        <audio id="pickupSound" src="Avatar/Sounds/pickup.mp3" preload="auto"></audio>
        <audio id="putdownSound" src="Avatar/Sounds/putdown.mp3" preload="auto"></audio>
        <audio id="chatSound" src="Avatar/Sounds/chat.mp3" preload="auto"></audio>
        
        <!-- Popup Overlay -->
        <div id="customizer" class="popup-overlay">
            <div class="popup-content">
                <!-- Left side - Avatar Preview -->
                <div id="fittingRoom" class="fitting-room" style="flex: 1; background-image: url('Avatar/Images/Background1.png');">
                    <!-- Save Button at top center of preview -->
                    <div class="save-button-container">
                        <button id="saveAvatar" class="main-button" data-sound="play" style="cursor: pointer;">
                            SAVE AVATAR
                        </button>
                    </div>
                    
                    <!-- Background navigation arrows -->
                    <div class="bg-nav-arrow left" id="prevBg" data-sound="play" style="cursor: pointer;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg>
                    </div>
                    <div class="bg-nav-arrow right" id="nextBg" data-sound="play" style="cursor: pointer;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                        </svg>
                    </div>
                    
                    <!-- Background indicator dots -->
                    <div class="bg-indicator" id="bgIndicator"><div class="bg-dot active" data-index="0" style="cursor: pointer;"></div><div class="bg-dot " data-index="1" style="cursor: pointer;"></div><div class="bg-dot " data-index="2" style="cursor: pointer;"></div><div class="bg-dot " data-index="3" style="cursor: pointer;"></div><div class="bg-dot " data-index="4" style="cursor: pointer;"></div></div>
                    
                    <!-- Avatar Stand -->
                    <div class="avatar-stand">
                        <div class="avatar-preview">
                            <img id="bodyLayer" class="avatar-layer" src="Avatar/Images/Default.png" alt="Body">
                            <img id="hairLayer" class="avatar-layer" src="" alt="Hair" style="display: none;">
                            <img id="eyesLayer" class="avatar-layer" src="Avatar/Images/Eyes.png" alt="Eyes" style="display: block;">
                        </div>
                    </div>
                </div>
                
                <!-- Right side - Controls -->
                <div class="controls-section">
                    <div class="flex justify-end mb-2">
                        <button id="closeCustomizer" class="text-f8e8b0 hover:text-white focus:outline-none" style="cursor: pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Scrollable content area -->
                    <div class="controls-content">
                        <!-- Customization Options -->
                        <div class="space-y-3">
                            <!-- Body Color Options -->
                            <div class="customizer-panel p-2">
                                <h3 class="category-title mb-2">BODY COLOR</h3>
                                <div class="grid grid-cols-1 gap-2">
                                    <button class="option-btn active rounded-lg btn-default" data-body="Default" data-sound="play" style="cursor: pointer;">
                                        DEFAULT
                                    </button>
                                    <button class="option-btn rounded-lg btn-blue" data-body="Default_Blue" data-sound="play" style="cursor: pointer;">
                                        BLUE
                                    </button>
                                    <button class="option-btn rounded-lg btn-purple" data-body="Default_Purple" data-sound="play" style="cursor: pointer;">
                                        PURPLE
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Hairstyle Options -->
                            <div class="customizer-panel p-2">
                                <h3 class="category-title mb-2">HAIRSTYLE</h3>
                                <div class="grid grid-cols-1 gap-2">
                                    <button class="option-btn active rounded-lg btn-none" data-hair="none" data-sound="play" style="cursor: pointer;">
                                        NONE
                                    </button>
                                    <button class="option-btn rounded-lg" style="background-color: rgb(255, 127, 80); cursor: pointer;" data-hair="Hairstyle1" data-sound="play">
                                        FLAME
                                    </button>
                                    <button class="option-btn rounded-lg" style="background-color: rgb(255, 182, 193); cursor: pointer;" data-hair="Hairstyle2" data-sound="play">
                                        BUNNY EARS
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Eye Color Options -->
                            <div class="customizer-panel p-2">
                                <h3 class="category-title mb-2">EYE COLOR</h3>
                                <div class="grid grid-cols-1 gap-2">
                                    <button class="option-btn rounded-lg btn-none" data-eyes="none" data-sound="play" style="cursor: pointer;">
                                        NONE
                                    </button>
                                    <button class="option-btn active rounded-lg btn-black" data-eyes="Eyes" data-sound="play" style="cursor: pointer;">
                                        DEFAULT
                                    </button>
                                    <button class="option-btn rounded-lg btn-blue" data-eyes="Blue_Eyes" data-sound="play" style="cursor: pointer;">
                                        BLUE
                                    </button>
                                    <button class="option-btn rounded-lg btn-green" data-eyes="Green_Eyes" data-sound="play" style="cursor: pointer;">
                                        GREEN
                                    </button>
                                    <button class="option-btn rounded-lg btn-pink" data-eyes="Pink_Eyes" data-sound="play" style="cursor: pointer;">
                                        PINK
                                    </button>
                                    <button class="option-btn rounded-lg btn-purple" data-eyes="Purple_Eyes" data-sound="play" style="cursor: pointer;">
                                        PURPLE
                                    </button>
                                    <button class="option-btn rounded-lg btn-red" data-eyes="Red_Eyes" data-sound="play" style="cursor: pointer;">
                                        RED
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="relative h-screen w-screen overflow-hidden">
        <!-- Audio Elements -->
        <audio id="doorbell-sound" src="Sounds/doorbell.mp3" preload="auto"></audio>
        <audio id="door-open-sound" src="Sounds/dooropen.mp3" preload="auto"></audio>
        <audio id="amb-front" src="Sounds/ambFront.mp3" preload="auto" loop=""></audio>

        <audio id="living-sound" src="Sounds/living.mp4" preload="auto"></audio>
        <audio id="amb-living" src="Sounds/ambLiving.mp3" preload="auto" loop=""></audio>

        <audio id="bedroom-sound" src="Sounds/bedroom.mp4" preload="auto"></audio>
        <audio id="amb-bedroom" src="Sounds/ambBedroom.mp3" preload="auto" loop=""></audio>

        <audio id="kitchen-sound" src="Sounds/kitchen.mp4" preload="auto"></audio>
        <audio id="amb-kitchen" src="Sounds/ambKitchen.mp3" preload="auto" loop=""></audio>

        <audio id="garden-sound" src="Sounds/garden.mp4" preload="auto"></audio>
        <audio id="amb-garden" src="Sounds/ambGarden.mp3" preload="auto" loop=""></audio>

        <!-- Mute Button -->
        <div class="absolute top-4 left-4 z-50">
            <button id="mute-button"
                class="mute-button text-white p-3 rounded-full focus:outline-none flex items-center justify-center">
                <i id="sound-on-icon" class="fas fa-volume-up text-xl"></i>
                <i id="sound-off-icon" class="fas fa-volume-mute text-xl hidden"></i>
            </button>
        </div>

        <!-- Exit Button (only visible in main content) -->
        <div id="exit-button" class="absolute top-4 right-4 z-50 opacity-0 pointer-events-none">
            <button class="exit-button text-white p-3 rounded-full focus:outline-none flex items-center justify-center">
                <i class="fas fa-door-open text-xl"></i>
            </button>
        </div>

        <!-- Title Sign (visible on all pages) - Hippie themed -->
        <div class="absolute top-0 left-0 right-0 z-40 text-center flex flex-col items-center pt-2">
            <div id="main-sign" class="sign-container">
                <!-- Hippie-themed SVG Sign -->
                <div class="hippie-sign">
                    <svg width="320" height="160" viewBox="0 0 320 160" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background with rounded corners -->
                        <rect x="10" y="20" width="300" height="120" rx="20" ry="20" fill="#8B4513" stroke="#5D2906"
                            stroke-width="5"></rect>

                        <!-- Tie-dye background pattern -->
                        <defs>
                            <radialGradient id="tiedye" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                                <stop offset="0%" stop-color="#FF5E5E"></stop>
                                <stop offset="16%" stop-color="#FF9D5E"></stop>
                                <stop offset="33%" stop-color="#FFDE5E"></stop>
                                <stop offset="50%" stop-color="#5EFF5E"></stop>
                                <stop offset="66%" stop-color="#5E9DFF"></stop>
                                <stop offset="83%" stop-color="#D55EFF"></stop>
                                <stop offset="100%" stop-color="#FF5E5E"></stop>
                            </radialGradient>
                        </defs>

                        <!-- Tie-dye background -->
                        <rect x="20" y="30" width="280" height="100" rx="15" ry="15" fill="url(#tiedye)"
                            stroke="#6B3E26" stroke-width="2"></rect>

                        <!-- Swirly patterns -->
                        <path
                            d="M40,50 C60,30 80,70 100,50 C120,30 140,70 160,50 C180,30 200,70 220,50 C240,30 260,70 280,50"
                            stroke="#FFFFFF" stroke-width="2" fill="none" opacity="0.3"></path>
                        <path
                            d="M40,80 C60,60 80,100 100,80 C120,60 140,100 160,80 C180,60 200,100 220,80 C240,60 260,100 280,80"
                            stroke="#FFFFFF" stroke-width="2" fill="none" opacity="0.3"></path>
                        <path
                            d="M40,110 C60,90 80,130 100,110 C120,90 140,130 160,110 C180,90 200,130 220,110 C240,90 260,130 280,110"
                            stroke="#FFFFFF" stroke-width="2" fill="none" opacity="0.3"></path>
                    </svg>
                </div>
                <div class="sign-overlay">
                    <h1 class="sign-text text-3xl md:text-4xl flex flex-col">
                        <span>Hippie</span>
                        <span>Hangout</span>
                    </h1>
                </div>
            </div>
        </div>

        <!-- Front Door Page -->
        <div id="front-door" class="room" style="background-image: url('Images/Front.gif');">
            <!--Avatar Customization Screen-->
             
            <!-- Door Container - Slightly smaller -->
            <div id="door-container" style="z-index: 9998;" class="door-container">
                <!-- Static Door Image -->
                <img id="door-static" src="Images/door.png" alt="Door" class="door-image">

                <!-- Fallback SVG if image fails to load -->
                <svg id="door-static-fallback" class="door-fallback" viewBox="0 0 300 500"
                    xmlns="http://www.w3.org/2000/svg">
                    <rect x="50" y="20" width="200" height="460" rx="5" ry="5" fill="#8B4513" stroke="#5D2906"
                        stroke-width="5"></rect>
                    <rect x="70" y="40" width="160" height="420" rx="3" ry="3" fill="#A0522D" stroke="#6B3E26"
                        stroke-width="2"></rect>
                    <circle cx="220" cy="250" r="10" fill="#D4AF37" stroke="#5D2906" stroke-width="1"></circle>
                </svg>

                <!-- Door GIF (hidden initially) -->
                <img id="door-gif" src="Images/door.gif" alt="Door Opening" class="door-image hidden">

                <!-- Fallback SVG if GIF fails to load -->
                <svg id="door-gif-fallback" class="door-fallback hidden" viewBox="0 0 300 500"
                    xmlns="http://www.w3.org/2000/svg">
                    <rect x="50" y="20" width="200" height="460" rx="5" ry="5" fill="#8B4513" stroke="#5D2906"
                        stroke-width="5"></rect>
                    <rect x="70" y="40" width="160" height="420" rx="3" ry="3" fill="#A0522D" stroke="#6B3E26"
                        stroke-width="2" transform="rotate(30, 150, 250)"></rect>
                    <circle cx="220" cy="250" r="10" fill="#D4AF37" stroke="#5D2906" stroke-width="1"></circle>
                </svg>

                <!-- Purple Doorbell - moved left and higher -->
                <div id="doorbell" class="doorbell">
                    <div class="doorbell-outer"></div>
                    <div class="doorbell-inner"></div>
                    <div class="doorbell-button"></div>
                </div>
            </div>
        </div>

        <!-- Main Content (initially hidden) -->
        <div id="main-content" class="absolute inset-0 opacity-0 pointer-events-none transition-opacity duration-1000">
            <!-- Navigation Arrows -->
            <div class="absolute left-6 top-1/2 transform -translate-y-1/2 z-50">
                <button id="left-arrow"
                    class="nav-arrow text-white p-4 rounded-full focus:outline-none flex items-center justify-center">
                    <i class="fas fa-chevron-left text-2xl"></i>
                </button>
            </div>

            <div class="absolute right-6 top-1/2 transform -translate-y-1/2 z-50">
                <button id="right-arrow"
                    class="nav-arrow text-white p-4 rounded-full focus:outline-none flex items-center justify-center">
                    <i class="fas fa-chevron-right text-2xl"></i>
                </button>
            </div>

            <!-- Room Subtitle Sign - Centered under main sign -->
            <div id="room-sign"
                class="absolute top-40 left-0 right-0 z-40 text-center flex flex-col items-center opacity-0">
                <div class="sign-container" style="transform: scale(0.7);">
                    <!-- Hippie-themed SVG Sign -->
                    <div class="hippie-sign">
                        <svg width="240" height="120" viewBox="0 0 240 120" xmlns="http://www.w3.org/2000/svg">
                            <!-- Background with rounded corners -->
                            <rect x="10" y="15" width="220" height="90" rx="15" ry="15" fill="#8B4513" stroke="#5D2906"
                                stroke-width="4"></rect>

                            <!-- Tie-dye background -->
                            <rect x="18" y="23" width="204" height="74" rx="10" ry="10" fill="url(#tiedye)"
                                stroke="#6B3E26" stroke-width="2"></rect>

                            <!-- Swirly patterns -->
                            <path
                                d="M30,40 C45,30 60,50 75,40 C90,30 105,50 120,40 C135,30 150,50 165,40 C180,30 195,50 210,40"
                                stroke="#FFFFFF" stroke-width="1.5" fill="none" opacity="0.3"></path>
                            <path
                                d="M30,60 C45,50 60,70 75,60 C90,50 105,70 120,60 C135,50 150,70 165,60 C180,50 195,70 210,60"
                                stroke="#FFFFFF" stroke-width="1.5" fill="none" opacity="0.3"></path>
                            <path
                                d="M30,80 C45,70 60,90 75,80 C90,70 105,90 120,80 C135,70 150,90 165,80 C180,70 195,90 210,80"
                                stroke="#FFFFFF" stroke-width="1.5" fill="none" opacity="0.3"></path>
                        </svg>
                    </div>
                    <div class="sign-overlay">
                        <h2 id="room-subtitle" class="sign-text text-lg md:text-xl">Living Room</h2>
                    </div>
                </div>
            </div>

            <iframe src="Rooms/living.html" style="min-width: 100%; min-height: 100%" id="living-room" class="room pointer-events-none"></iframe>

            <iframe src="Rooms/bedroom.html" style="min-width: 100%; min-height: 100%" id="bedroom" class="room opacity-0 pointer-events-none"></iframe>

            <iframe src="Rooms/kitchen.html" style="min-width: 100%; min-height: 100%" id="kitchen" class="room opacity-0 pointer-events-none"></iframe>

            <iframe src="Rooms/garden.html" style="min-width: 100%; min-height: 100%" id="garden" class="room opacity-0 pointer-events-none"></iframe>

        </div>
    </div>

    <script src="functions.js" type="text/javascript"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const openBtn = document.getElementById('openCustomizer');
            const closeBtn = document.getElementById('closeCustomizer');
            const popup = document.getElementById('customizer');
            const saveBtn = document.getElementById('saveAvatar');
            const buttonSound = document.getElementById('buttonSound');
            const pickupSound = document.getElementById('pickupSound');
            const putdownSound = document.getElementById('putdownSound');
            const chatSound = document.getElementById('chatSound');
            const fittingRoom = document.getElementById('fittingRoom');
            const prevBgBtn = document.getElementById('prevBg');
            const nextBgBtn = document.getElementById('nextBg');
            const bgIndicator = document.getElementById('bgIndicator');
            const mainAvatar = document.getElementById('mainAvatar');
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChat');
            const minimizeChatBtn = document.getElementById('minimizeChat');
            const chatHeader = document.getElementById('chatHeader');
            const showHistoryBtn = document.getElementById('showHistory');
            const closeHistoryBtn = document.getElementById('closeHistory');
            const chatHistoryPanel = document.getElementById('chatHistoryPanel');
            const chatHistoryContent = document.getElementById('chatHistoryContent');
            const usernameModal = document.getElementById('usernameModal');
            const usernameInput = document.getElementById('usernameInput');
            const usernameSubmit = document.getElementById('usernameSubmit');
            const userLabel = document.getElementById('userLabel');
            const micButton = document.getElementById('micButton');
            const voiceIndicator = document.getElementById('voiceIndicator');
            
            // Chat container state
            let isChatMinimized = false;
            const chatContainer = document.querySelector('.chat-container');
            
            // Username state
            let username = "User";
            
            // Voice chat state
            let isMicActive = false;
            let voiceAnimationInterval = null;
            
            // Chat history
            let chatHistory = [];
            
            // Avatar layers in customizer
            const bodyLayer = document.getElementById('bodyLayer');
            const hairLayer = document.getElementById('hairLayer');
            const eyesLayer = document.getElementById('eyesLayer');
            
            // Main avatar layers (always visible)
            const mainBodyLayer = document.getElementById('mainBodyLayer');
            const mainHairLayer = document.getElementById('mainHairLayer');
            const mainEyesLayer = document.getElementById('mainEyesLayer');
            
            // Default avatar settings
            let currentBody = "Default";
            let currentHair = "none";
            let currentEyes = "Eyes";
            
            // Background settings
            const backgrounds = [
                { name: "Background1", path: "Avatar/Images/Background1.png" },
                { name: "Background2", path: "Avatar/Images/Background2.png" },
                { name: "Background3", path: "Avatar/Images/Background3.png" },
                { name: "Background4", path: "Avatar/Images/Background4.png" },
                { name: "Background5", path: "Avatar/Images/Background5.png" }
            ];
            let currentBgIndex = 0;
            
            // Simulated other users
            const otherUsers = [
                { 
                    id: 'user1', 
                    username: 'CoolCat42', 
                    body: 'Default_Blue', 
                    hair: 'Hairstyle1', 
                    eyes: 'Blue_Eyes',
                    position: { x: '20%', y: '60%' }
                },
                { 
                    id: 'user2', 
                    username: 'PixelPal', 
                    body: 'Default_Purple', 
                    hair: 'Hairstyle2', 
                    eyes: 'Pink_Eyes',
                    position: { x: '70%', y: '70%' }
                },
                { 
                    id: 'user3', 
                    username: 'RetroGamer', 
                    body: 'Default', 
                    hair: 'none', 
                    eyes: 'Green_Eyes',
                    position: { x: '85%', y: '65%' }
                }
            ];
            
            // Create other users' avatars
            function createOtherUsers() {
                otherUsers.forEach(user => {
                    // Create avatar container
                    const avatar = document.createElement('div');
                    avatar.id = user.id;
                    avatar.className = 'avatar other-user';
                    avatar.style.left = user.position.x;
                    avatar.style.top = user.position.y;
                    avatar.style.transform = 'none';
                    avatar.style.bottom = 'auto';
                    
                    // Create avatar layers
                    const bodyImg = document.createElement('img');
                    bodyImg.className = 'avatar-layer';
                    bodyImg.src = `Avatar/Images/${user.body}.png`;
                    bodyImg.alt = 'Body';
                    
                    const eyesImg = document.createElement('img');
                    eyesImg.className = 'avatar-layer';
                    eyesImg.src = `Avatar/Images/${user.eyes}.png`;
                    eyesImg.alt = 'Eyes';
                    
                    // Add hair if present
                    if (user.hair !== 'none') {
                        const hairImg = document.createElement('img');
                        hairImg.className = 'avatar-layer';
                        hairImg.src = `Avatar/Images/${user.hair}.png`;
                        hairImg.alt = 'Hair';
                        avatar.appendChild(hairImg);
                    }
                    
                    // Create username label
                    const label = document.createElement('div');
                    label.className = 'user-label';
                    label.textContent = user.username;
                    
                    // Add elements to avatar
                    avatar.appendChild(bodyImg);
                    avatar.appendChild(eyesImg);
                    avatar.appendChild(label);
                    
                    // Add avatar to document
                    document.querySelector('.avatar-customizer-container').appendChild(avatar);
                });
            }
            
            // Create background indicator dots
            function createBgIndicators() {
                bgIndicator.innerHTML = '';
                backgrounds.forEach((bg, index) => {
                    const dot = document.createElement('div');
                    dot.className = `bg-dot ${index === currentBgIndex ? 'active' : ''}`;
                    dot.setAttribute('data-index', index);
                    dot.addEventListener('click', () => {
                        playButtonSound();
                        setBackground(index);
                    });
                    bgIndicator.appendChild(dot);
                });
            }
            
            // Set background by index
            function setBackground(index) {
                currentBgIndex = index;
                fittingRoom.style.backgroundImage = `url('${backgrounds[index].path}')`;
                
                // Update indicator dots
                document.querySelectorAll('.bg-dot').forEach((dot, i) => {
                    if (i === index) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
                
                // Save background preference
                localStorage.setItem('avatarBackground', index);
            }
            
            // Initialize background indicators
            createBgIndicators();
            
            // Load saved background if exists
            if (localStorage.getItem('avatarBackground')) {
                const savedBgIndex = parseInt(localStorage.getItem('avatarBackground'));
                if (!isNaN(savedBgIndex) && savedBgIndex >= 0 && savedBgIndex < backgrounds.length) {
                    setBackground(savedBgIndex);
                }
            }
            
            // Background navigation
            prevBgBtn.addEventListener('click', () => {
                playButtonSound();
                let newIndex = currentBgIndex - 1;
                if (newIndex < 0) newIndex = backgrounds.length - 1;
                setBackground(newIndex);
            });
            
            nextBgBtn.addEventListener('click', () => {
                playButtonSound();
                let newIndex = currentBgIndex + 1;
                if (newIndex >= backgrounds.length) newIndex = 0;
                setBackground(newIndex);
            });
            
            // Load saved avatar settings if they exist
            loadAvatarSettings();
            
            // Function to load avatar settings from localStorage
            function loadAvatarSettings() {
                // Check if user has saved avatar settings
                if (localStorage.getItem('avatarSettings')) {
                    const savedSettings = JSON.parse(localStorage.getItem('avatarSettings'));
                    
                    // Apply saved settings
                    currentBody = savedSettings.body || "Default";
                    currentHair = savedSettings.hair || "none";
                    currentEyes = savedSettings.eyes || "Eyes";
                    
                    // Update avatar display in customizer
                    updateAvatarDisplay();
                    
                    // Update main avatar display
                    updateMainAvatarDisplay();
                    
                    // Update active buttons
                    document.querySelectorAll('[data-body]').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-body') === currentBody) {
                            btn.classList.add('active');
                        }
                    });
                    
                    document.querySelectorAll('[data-hair]').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-hair') === currentHair) {
                            btn.classList.add('active');
                        }
                    });
                    
                    document.querySelectorAll('[data-eyes]').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-eyes') === currentEyes) {
                            btn.classList.add('active');
                        }
                    });
                } else {
                    // Set default avatar for new users
                    updateAvatarDisplay();
                    updateMainAvatarDisplay();
                }
                
                // Load saved position if exists
                if (localStorage.getItem('avatarPosition')) {
                    const position = JSON.parse(localStorage.getItem('avatarPosition'));
                    mainAvatar.style.left = position.x + 'px';
                    mainAvatar.style.top = position.y + 'px';
                    mainAvatar.style.transform = 'none';
                    mainAvatar.style.bottom = 'auto';
                } else {
                    // Position at bottom center by default
                    positionAvatarAtBottom();
                }
                
                // Load saved username if exists
                if (localStorage.getItem('username')) {
                    username = localStorage.getItem('username');
                    userLabel.textContent = username;
                    // Skip username modal if already set
                    usernameModal.style.display = 'none';
                }
            }
            
            // Function to position avatar at the bottom of the screen
            function positionAvatarAtBottom() {
                // Calculate position to place avatar at the bottom of the screen
                // with just the top portion visible (about 1/3 of the avatar height)
                const avatarHeight = mainAvatar.offsetHeight;
                const visiblePortion = avatarHeight * 0.4; // Show about 40% of the avatar
                
                mainAvatar.style.bottom = (visiblePortion - avatarHeight) + 'px';
                mainAvatar.style.left = '50%';
                mainAvatar.style.transform = 'translateX(-50%)';
                mainAvatar.style.top = 'auto';
            }
            
            // Function to update avatar display in customizer
            function updateAvatarDisplay() {
                // Determine which body image to show based on body color and hairstyle
                let bodyImagePath = `Avatar/Images/${currentBody}.png`;
                
                // If there's a hairstyle and it's not the default body, use the combined image
                if (currentHair !== "none" && currentBody !== "Default") {
                    bodyImagePath = `Avatar/Images/${currentHair}_${currentBody.split('_')[1]}.png`;
                } else if (currentHair !== "none") {
                    // If there's a hairstyle and it's the default body
                    bodyImagePath = `Avatar/Images/${currentHair}.png`;
                }
                
                // Set the body/hairstyle image
                bodyLayer.src = bodyImagePath;
                
                // Set the eyes image if not none
                if (currentEyes !== "none") {
                    eyesLayer.src = `Avatar/Images/${currentEyes}.png`;
                    eyesLayer.style.display = 'block';
                } else {
                    eyesLayer.style.display = 'none';
                }
            }
            
            // Function to update main avatar display
            function updateMainAvatarDisplay() {
                // Determine which body image to show based on body color and hairstyle
                let bodyImagePath = `Avatar/Images/${currentBody}.png`;
                
                // If there's a hairstyle and it's not the default body, use the combined image
                if (currentHair !== "none" && currentBody !== "Default") {
                    bodyImagePath = `Avatar/Images/${currentHair}_${currentBody.split('_')[1]}.png`;
                } else if (currentHair !== "none") {
                    // If there's a hairstyle and it's the default body
                    bodyImagePath = `Avatar/Images/${currentHair}.png`;
                }
                
                // Set the body/hairstyle image
                mainBodyLayer.src = bodyImagePath;
                
                // Set the eyes image if not none
                if (currentEyes !== "none") {
                    mainEyesLayer.src = `Avatar/Images/${currentEyes}.png`;
                    mainEyesLayer.style.display = 'block';
                } else {
                    mainEyesLayer.style.display = 'none';
                }
            }
            
            // Function to save avatar settings
            function saveAvatarSettings() {
                const settings = {
                    body: currentBody,
                    hair: currentHair,
                    eyes: currentEyes
                };
                
                localStorage.setItem('avatarSettings', JSON.stringify(settings));
            }
            
            // Function to save avatar position
            function saveAvatarPosition() {
                const rect = mainAvatar.getBoundingClientRect();
                const position = {
                    x: rect.left,
                    y: rect.top
                };
                localStorage.setItem('avatarPosition', JSON.stringify(position));
            }
            
            // Function to play button sound
            function playButtonSound() {
                buttonSound.currentTime = 0;
                buttonSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Function to play pickup sound
            function playPickupSound() {
                pickupSound.currentTime = 0;
                pickupSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Function to play putdown sound
            function playPutdownSound() {
                putdownSound.currentTime = 0;
                putdownSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Function to play chat sound
            function playChatSound() {
                chatSound.currentTime = 0;
                chatSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Add sound to all buttons with data-sound attribute
            document.querySelectorAll('[data-sound="play"]').forEach(button => {
                button.addEventListener('click', playButtonSound);
            });
            
            // Open and close popup
            openBtn.addEventListener('click', () => {
                playButtonSound();
                popup.style.display = 'flex';
                // Hide main avatar when customizer is open
                mainAvatar.style.display = 'none';
            });
            
            closeBtn.addEventListener('click', () => {
                playButtonSound();
                popup.style.display = 'none';
                // Show main avatar when customizer is closed
                mainAvatar.style.display = 'block';
            });
            
            // Close when clicking outside
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    playButtonSound();
                    popup.style.display = 'none';
                    // Show main avatar when customizer is closed
                    mainAvatar.style.display = 'block';
                }
            });
            
            // Body color selection
            document.querySelectorAll('[data-body]').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('[data-body]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update body
                    currentBody = button.getAttribute('data-body');
                    
                    // Update both avatar displays
                    updateAvatarDisplay();
                    updateMainAvatarDisplay();
                });
            });
            
            // Hairstyle selection
            document.querySelectorAll('[data-hair]').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('[data-hair]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update hair
                    currentHair = button.getAttribute('data-hair');
                    
                    // Update both avatar displays
                    updateAvatarDisplay();
                    updateMainAvatarDisplay();
                });
            });
            
            // Eye color selection
            document.querySelectorAll('[data-eyes]').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('[data-eyes]').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update eyes
                    currentEyes = button.getAttribute('data-eyes');
                    
                    // Update both avatar displays
                    updateAvatarDisplay();
                    updateMainAvatarDisplay();
                });
            });
            
            // Save avatar with retro notification
            saveBtn.addEventListener('click', () => {
                // Save current settings
                saveAvatarSettings();
                saveAvatarPosition();
                
                // Show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-600 text-white p-3 rounded-lg shadow-lg z-50 font-["Press_Start_2P"] text-xs';
                notification.style.border = '4px solid #f8e8b0';
                notification.style.backgroundColor = '#6b8e23';
                notification.style.color = '#f8e8b0';
                notification.style.padding = '10px';
                notification.style.zIndex = '10000';
                notification.textContent = 'AVATAR SAVED!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
                
                // Close the customizer
                popup.style.display = 'none';
                // Show main avatar when customizer is closed
                mainAvatar.style.display = 'block';
            });
            
            // Make the main avatar draggable
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            
            // Always set cursor to pointer for main avatar
            mainAvatar.style.cursor = 'pointer';
            
            // Mouse events for dragging
            mainAvatar.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // Touch events for mobile
            mainAvatar.addEventListener('touchstart', startDragTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', endDragTouch);
            
            function startDrag(e) {
                if (popup.style.display === 'flex') return; // Don't drag if customizer is open
                
                isDragging = true;
                mainAvatar.classList.add('dragging');
                
                const rect = mainAvatar.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                playPickupSound();
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                let newX = e.clientX - dragOffsetX;
                let newY = e.clientY - dragOffsetY;
                
                // Keep avatar within viewport bounds with minimal margins
                // Only add a small margin at the top to protect menu items
                const topMargin = 20; // Reduced top margin
                
                // Calculate boundaries to ensure avatar is always visible
                // Don't allow avatar to go off-screen
                const minX = 0;
                const maxX = window.innerWidth - mainAvatar.offsetWidth;
                const minY = topMargin;
                const maxY = window.innerHeight - mainAvatar.offsetHeight * 0.25;
                
                newX = Math.max(minX, Math.min(maxX, newX));
                newY = Math.max(minY, Math.min(maxY, newY));
                
                mainAvatar.style.left = newX + 'px';
                mainAvatar.style.top = newY + 'px';
                mainAvatar.style.transform = 'none';
                mainAvatar.style.bottom = 'auto'; // Clear bottom positioning when dragging
                
                // Update speech bubbles position
                updateSpeechBubblesPosition();
                
                e.preventDefault();
            }
            
            function endDrag() {
                if (!isDragging) return;
                
                isDragging = false;
                mainAvatar.classList.remove('dragging');
                
                playPutdownSound();
                saveAvatarPosition();
            }
            
            // Touch event handlers
            function startDragTouch(e) {
                if (popup.style.display === 'flex') return; // Don't drag if customizer is open
                
                isDragging = true;
                mainAvatar.classList.add('dragging');
                
                const rect = mainAvatar.getBoundingClientRect();
                const touch = e.touches[0];
                dragOffsetX = touch.clientX - rect.left;
                dragOffsetY = touch.clientY - rect.top;
                
                playPickupSound();
                
                e.preventDefault();
            }
            
            function dragTouch(e) {
                if (!isDragging) return;
                
                const touch = e.touches[0];
                let newX = touch.clientX - dragOffsetX;
                let newY = touch.clientY - dragOffsetY;
                
                // Keep avatar within viewport bounds with minimal margins
                // Only add a small margin at the top to protect menu items
                const topMargin = 20; // Reduced top margin
                
                // Calculate boundaries to ensure avatar is always visible
                // Don't allow avatar to go off-screen
                const minX = 0;
                const maxX = window.innerWidth - mainAvatar.offsetWidth;
                const minY = topMargin;
                const maxY = window.innerHeight - mainAvatar.offsetHeight * 0.25;
                
                newX = Math.max(minX, Math.min(maxX, newX));
                newY = Math.max(minY, Math.min(maxY, newY));
                
                mainAvatar.style.left = newX + 'px';
                mainAvatar.style.top = newY + 'px';
                mainAvatar.style.transform = 'none';
                mainAvatar.style.bottom = 'auto'; // Clear bottom positioning when dragging
                
                // Update speech bubbles position
                updateSpeechBubblesPosition();
                
                e.preventDefault();
            }
            
            function endDragTouch() {
                if (!isDragging) return;
                
                isDragging = false;
                mainAvatar.classList.remove('dragging');
                
                playPutdownSound();
                saveAvatarPosition();
            }
            
            // Chat functionality
            function sendChat() {
                const message = chatInput.value.trim();
                if (message === '') return;
                
                // Play chat sound
                playChatSound();
                
                // Create speech bubble
                createSpeechBubble(message, username);
                
                // Add to chat history
                addToChatHistory(username, message);
                
                // Clear input
                chatInput.value = '';
                
                // Simulate other users responding occasionally
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                        const randomMessages = [
                            "Hey there!",
                            "Cool avatar!",
                            "How's it going?",
                            "Nice to meet you!",
                            "I like your style!",
                            "What's up?",
                            "Hello everyone!",
                            "This is fun!",
                            "Anyone want to chat?",
                            "I'm new here!"
                        ];
                        const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];
                        
                        // Create speech bubble for other user
                        createOtherUserSpeechBubble(randomMessage, randomUser);
                        
                        // Add to chat history
                        addToChatHistory(randomUser.username, randomMessage);
                        
                        // Play chat sound
                        playChatSound();
                    }, Math.random() * 3000 + 1000);
                }
            }
            
            // Create speech bubble above avatar
            function createSpeechBubble(message, username) {
                // Get existing bubbles
                const existingBubbles = document.querySelectorAll('.speech-bubble[data-user="' + username + '"]');
                
                // If we already have 3 bubbles, remove the oldest one
                if (existingBubbles.length >= 3) {
                    existingBubbles[0].remove();
                }
                
                // Create new speech bubble
                const bubble = document.createElement('div');
                bubble.className = 'speech-bubble';
                bubble.textContent = message;
                bubble.setAttribute('data-user', username);
                document.body.appendChild(bubble);
                
                // Position bubble above avatar
                positionSpeechBubble(bubble, mainAvatar, existingBubbles.length);
                
                // Remove bubble after 5 seconds
                setTimeout(() => {
                    bubble.style.animation = 'bubble-disappear 0.3s forwards';
                    setTimeout(() => bubble.remove(), 300);
                }, 5000);
            }
            
            // Create speech bubble for other users
            function createOtherUserSpeechBubble(message, user) {
                const otherAvatar = document.getElementById(user.id);
                if (!otherAvatar) return;
                
                // Get existing bubbles
                const existingBubbles = document.querySelectorAll('.speech-bubble[data-user="' + user.username + '"]');
                
                // If we already have 3 bubbles, remove the oldest one
                if (existingBubbles.length >= 3) {
                    existingBubbles[0].remove();
                }
                
                // Create new speech bubble
                const bubble = document.createElement('div');
                bubble.className = 'speech-bubble';
                bubble.textContent = message;
                bubble.setAttribute('data-user', user.username);
                document.body.appendChild(bubble);
                
                // Position bubble above avatar
                positionSpeechBubble(bubble, otherAvatar, existingBubbles.length);
                
                // Remove bubble after 5 seconds
                setTimeout(() => {
                    bubble.style.animation = 'bubble-disappear 0.3s forwards';
                    setTimeout(() => bubble.remove(), 300);
                }, 5000);
                
                // Simulate voice chat
                if (Math.random() > 0.7) {
                    simulateVoiceChat(user.id);
                }
            }
            
            // Position speech bubble above avatar
            function positionSpeechBubble(bubble, avatar, bubbleIndex) {
                const avatarRect = avatar.getBoundingClientRect();
                const bubbleWidth = bubble.offsetWidth;
                
                // Position bubble centered above avatar
                // Adjust vertical position based on bubble index (0, 1, or 2)
                // This stacks bubbles from bottom to top
                const left = avatarRect.left + (avatarRect.width / 2) - (bubbleWidth / 2);
                const top = avatarRect.top - bubble.offsetHeight - 20 - (bubbleIndex * (bubble.offsetHeight + 10));
                
                bubble.style.left = `${left}px`;
                bubble.style.top = `${top}px`;
            }
            
            // Update all speech bubbles positions
            function updateSpeechBubblesPosition() {
                const bubbles = document.querySelectorAll('.speech-bubble[data-user="' + username + '"]');
                bubbles.forEach((bubble, index) => {
                    positionSpeechBubble(bubble, mainAvatar, index);
                });
            }
            
            // Add message to chat history
            function addToChatHistory(user, message) {
                // Add to chat history array
                chatHistory.push({ user, message, timestamp: new Date() });
                
                // Create message element
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message';
                
                const usernameElement = document.createElement('div');
                usernameElement.className = 'username';
                usernameElement.textContent = user;
                
                const messageTextElement = document.createElement('div');
                messageTextElement.className = 'message-text';
                messageTextElement.textContent = message;
                
                messageElement.appendChild(usernameElement);
                messageElement.appendChild(messageTextElement);
                
                // Add to chat history panel
                chatHistoryContent.appendChild(messageElement);
                
                // Scroll to bottom
                chatHistoryContent.scrollTop = chatHistoryContent.scrollHeight;
            }
            
            // Username submission
            usernameSubmit.addEventListener('click', () => {
                const name = usernameInput.value.trim();
                if (name !== '') {
                    username = name;
                    userLabel.textContent = username;
                    localStorage.setItem('username', username);
                    usernameModal.style.display = 'none';
                    playButtonSound();
                    
                    // Create welcome message
                    setTimeout(() => {
                        addToChatHistory('System', `Welcome to the chat, ${username}!`);
                        createSpeechBubble(`Hi, I'm ${username}!`, username);
                    }, 500);
                    
                    // Create other users
                    createOtherUsers();
                    
                    // Simulate other users greeting
                    setTimeout(() => {
                        otherUsers.forEach((user, index) => {
                            setTimeout(() => {
                                const greeting = `Hey ${username}, welcome!`;
                                createOtherUserSpeechBubble(greeting, user);
                                addToChatHistory(user.username, greeting);
                                playChatSound();
                            }, index * 1500);
                        });
                    }, 2000);
                }
            });
            
            // Allow Enter key for username submission
            usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    usernameSubmit.click();
                }
            });
            
            // Chat event listeners
            sendChatBtn.addEventListener('click', sendChat);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChat();
            });
            
            // Make whole chat header clickable for minimize/maximize
            chatHeader.addEventListener('click', (e) => {
                // Don't trigger if clicking on the history button
                if (e.target === showHistoryBtn || e.target.parentNode === showHistoryBtn) {
                    return;
                }
                
                playButtonSound();
                
                if (isChatMinimized) {
                    // Maximize
                    chatContainer.style.height = 'auto';
                    chatInput.style.display = 'block';
                    sendChatBtn.style.display = 'block';
                    document.querySelector('.voice-controls').style.display = 'flex';
                    minimizeChatBtn.textContent = '_';
                } else {
                    // Minimize
                    chatContainer.style.height = '40px';
                    chatInput.style.display = 'none';
                    sendChatBtn.style.display = 'none';
                    document.querySelector('.voice-controls').style.display = 'none';
                    minimizeChatBtn.textContent = '□'; 
                }
                
                isChatMinimized = !isChatMinimized;
            });
            
            // Chat history panel controls
            showHistoryBtn.addEventListener('click', () => {
                playButtonSound();
                chatHistoryPanel.style.display = (chatHistoryPanel.style.display == 'flex' ? 'none' : 'flex');
            });
            
            closeHistoryBtn.addEventListener('click', () => {
                playButtonSound();
                chatHistoryPanel.style.display = 'none';
            });
            
            // Voice chat controls
            micButton.addEventListener('click', () => {
                playButtonSound();
                isMicActive = !isMicActive;
                
                if (isMicActive) {
                    // Activate microphone
                    micButton.classList.add('active');
                    voiceIndicator.classList.add('speaking');
                    
                    // Create speech bubble to indicate voice chat
                    createSpeechBubble("🎤 Voice chat active", username);
                    
                    // Add system message to chat history
                    addToChatHistory('System', `${username} started voice chat`);
                    
                    // Simulate voice activity
                    simulateVoiceChat('mainAvatar');
                } else {
                    // Deactivate microphone
                    micButton.classList.remove('active');
                    voiceIndicator.classList.remove('speaking');
                    
                    // Add system message to chat history
                    addToChatHistory('System', `${username} ended voice chat`);
                    
                    // Clear any voice animation interval
                    if (voiceAnimationInterval) {
                        clearInterval(voiceAnimationInterval);
                        voiceAnimationInterval = null;
                    }
                }
            });
            
            // Simulate voice chat activity
            function simulateVoiceChat(avatarId) {
                const avatar = document.getElementById(avatarId);
                if (!avatar) return;
                
                // Create voice indicator if it doesn't exist
                let voiceIcon = avatar.querySelector('.voice-icon');
                if (!voiceIcon) {
                    voiceIcon = document.createElement('div');
                    voiceIcon.className = 'voice-icon';
                    voiceIcon.style.position = 'absolute';
                    voiceIcon.style.top = '20px';
                    voiceIcon.style.right = '20px';
                    voiceIcon.style.width = '40px';
                    voiceIcon.style.height = '40px';
                    voiceIcon.style.backgroundColor = 'rgba(139, 111, 78, 0.8)';
                    voiceIcon.style.borderRadius = '50%';
                    voiceIcon.style.border = '2px solid #f8e8b0';
                    voiceIcon.style.display = 'flex';
                    voiceIcon.style.justifyContent = 'center';
                    voiceIcon.style.alignItems = 'center';
                    voiceIcon.style.zIndex = '9994';
                    
                    // Create speaker icon
                    const speakerSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    speakerSvg.setAttribute('width', '20');
                    speakerSvg.setAttribute('height', '20');
                    speakerSvg.setAttribute('viewBox', '0 0 24 24');
                    speakerSvg.setAttribute('fill', '#f8e8b0');
                    
                    const path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path1.setAttribute('d', 'M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z');
                    
                    speakerSvg.appendChild(path1);
                    voiceIcon.appendChild(speakerSvg);
                    
                    // Create voice bars
                    const voiceBars = document.createElement('div');
                    voiceBars.className = 'voice-indicator speaking';
                    voiceBars.style.position = 'absolute';
                    voiceBars.style.bottom = '-15px';
                    voiceBars.style.left = '50%';
                    voiceBars.style.transform = 'translateX(-50%)';
                    
                    for (let i = 0; i < 5; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'voice-bar';
                        voiceBars.appendChild(bar);
                    }
                    
                    voiceIcon.appendChild(voiceBars);
                    avatar.appendChild(voiceIcon);
                }
                
                // Show voice icon
                voiceIcon.style.display = 'flex';
                
                // Remove after random time (2-5 seconds)
                const duration = Math.random() * 3000 + 2000;
                setTimeout(() => {
                    if (voiceIcon && avatarId !== 'mainAvatar') {
                        voiceIcon.style.display = 'none';
                    } else if (voiceIcon && avatarId === 'mainAvatar' && !isMicActive) {
                        voiceIcon.style.display = 'none';
                    }
                }, duration);
            }
            
            // Set pointer cursor for all interactive elements
            document.querySelectorAll('button, .option-btn, .bg-nav-arrow, .bg-dot, .avatar').forEach(element => {
                element.style.cursor = 'pointer';
            });
            
            // Make sure the page stretches to fill the window
            function setFullHeight() {
                document.documentElement.style.height = '100%';
                document.body.style.height = '100%';
            }
            
            // Call on load and resize
            setFullHeight();
            window.addEventListener('resize', setFullHeight);
            
            // Reposition speech bubbles when window is resized
            window.addEventListener('resize', updateSpeechBubblesPosition);
            
            // Add event listener to update speech bubble position during drag
            document.addEventListener('mousemove', () => {
                if (isDragging) updateSpeechBubblesPosition();
            });
            
            document.addEventListener('touchmove', () => {
                if (isDragging) updateSpeechBubblesPosition();
            });
            
            // Simulate occasional chat from other users
            function simulateOtherUserChats() {
                setInterval(() => {
                    if (Math.random() > 0.8) {
                        const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                        const randomMessages = [
                            "This is so fun!",
                            "I love this chat room!",
                            "Anyone want to play a game?",
                            "How's everyone doing?",
                            "I just updated my avatar!",
                            "The weather is nice today!",
                            "What's everyone up to?",
                            "I'm having a great day!",
                            "This place is awesome!",
                            "Hello everyone!"
                        ];
                        const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];
                        
                        // Create speech bubble for other user
                        createOtherUserSpeechBubble(randomMessage, randomUser);
                        
                        // Add to chat history
                        addToChatHistory(randomUser.username, randomMessage);
                        
                        // Play chat sound
                        playChatSound();
                    }
                }, 15000); // Every 15 seconds there's a chance
            }
            
            // Start simulation after a delay
            setTimeout(simulateOtherUserChats, 5000);
        });
    </script>
</body>

</html>